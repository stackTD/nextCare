{% extends "base.html" %}

{% block title %}Add Parameter - {{ machine.name }}{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card shadow">
                <div class="card-header bg-primary text-white">
                    <h4 class="mb-0">
                        <i class="bi bi-plus-circle"></i> Add Parameter to {{ machine.name }}
                    </h4>
                </div>
                <div class="card-body">
                    <form method="POST">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="name" class="form-label">Parameter Name *</label>
                                    <input type="text" class="form-control" id="name" name="name" required
                                           placeholder="e.g., Temperature">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="register_address" class="form-label">Register Address *</label>
                                    <select class="form-select" id="register_address" name="register_address" required>
                                        <option value="">Select register...</option>
                                        <option value="D20">D20 - Temperature</option>
                                        <option value="D21">D21 - Vibration</option>
                                        <option value="D22">D22 - Shock</option>
                                        <option value="D23">D23 - Oil Supply</option>
                                        <option value="D24">D24 - Sound</option>
                                        <option value="D25">D25 - Pressure</option>
                                        <option value="D26">D26 - Speed</option>
                                        <option value="D27">D27 - Flow Rate</option>
                                        <option value="D28">D28 - Humidity</option>
                                        <option value="D29">D29 - Power</option>
                                    </select>
                                    <div class="form-text">PLC register to read data from</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label for="unit" class="form-label">Unit *</label>
                                    <input type="text" class="form-control" id="unit" name="unit" required
                                           placeholder="e.g., °C">
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label for="min_value" class="form-label">Minimum Value</label>
                                    <input type="number" step="0.01" class="form-control" id="min_value" name="min_value"
                                           placeholder="e.g., 0">
                                    <div class="form-text">Alert threshold minimum</div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label for="max_value" class="form-label">Maximum Value</label>
                                    <input type="number" step="0.01" class="form-control" id="max_value" name="max_value"
                                           placeholder="e.g., 100">
                                    <div class="form-text">Alert threshold maximum</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                            <a href="{{ url_for('config.list_parameters', machine_id=machine.machine_id) }}" 
                               class="btn btn-secondary">
                                <i class="bi bi-x-circle"></i> Cancel
                            </a>
                            <button type="submit" class="btn btn-primary">
                                <i class="bi bi-check-circle"></i> Create Parameter
                            </button>
                        </div>
                    </form>
                </div>
            </div>
            
            <!-- Quick Setup Section -->
            <div class="card mt-4">
                <div class="card-header">
                    <h6 class="mb-0"><i class="bi bi-lightning"></i> Quick Setup</h6>
                </div>
                <div class="card-body">
                    <p>Use these common parameter configurations:</p>
                    <div class="row">
                        <div class="col-md-6 mb-2">
                            <button type="button" class="btn btn-outline-info btn-sm w-100" 
                                    onclick="fillParameter('Temperature', 'D20', '°C', '20', '80')">
                                Temperature (D20)
                            </button>
                        </div>
                        <div class="col-md-6 mb-2">
                            <button type="button" class="btn btn-outline-info btn-sm w-100" 
                                    onclick="fillParameter('Vibration', 'D21', 'Hz', '0', '100')">
                                Vibration (D21)
                            </button>
                        </div>
                        <div class="col-md-6 mb-2">
                            <button type="button" class="btn btn-outline-info btn-sm w-100" 
                                    onclick="fillParameter('Shock', 'D22', 'g', '0', '10')">
                                Shock (D22)
                            </button>
                        </div>
                        <div class="col-md-6 mb-2">
                            <button type="button" class="btn btn-outline-info btn-sm w-100" 
                                    onclick="fillParameter('Oil Supply', 'D23', '%', '0', '100')">
                                Oil Supply (D23)
                            </button>
                        </div>
                        <div class="col-md-6 mb-2">
                            <button type="button" class="btn btn-outline-info btn-sm w-100" 
                                    onclick="fillParameter('Sound', 'D24', 'dB', '30', '90')">
                                Sound (D24)
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Parameter Info -->
            <div class="card mt-4">
                <div class="card-header">
                    <h6 class="mb-0"><i class="bi bi-info-circle"></i> Parameter Information</h6>
                </div>
                <div class="card-body">
                    <ul>
                        <li><strong>Register Address:</strong> PLC register where sensor data is stored (D20-D99)</li>
                        <li><strong>Unit:</strong> Measurement unit for display (°C, Hz, %, etc.)</li>
                        <li><strong>Min/Max Values:</strong> Alert thresholds - values outside this range trigger alerts</li>
                        <li><strong>Data Collection:</strong> System automatically reads data every 5 seconds</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function fillParameter(name, register, unit, minVal, maxVal) {
    document.getElementById('name').value = name;
    document.getElementById('register_address').value = register;
    document.getElementById('unit').value = unit;
    document.getElementById('min_value').value = minVal;
    document.getElementById('max_value').value = maxVal;
}
</script>
{% endblock %}